"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[866],{90281:function(e,n,t){t.d(n,{Z:function(){return p}});var o=t(87462),r=t(63366),c=t(67294),a=t(96204),s=t.n(a),i=t(7545);function u(e){var n=e.theme,t=e.name,r=e.props;if(!(n&&n.components&&n.components[t]&&n.components[t].defaultProps))return r;var c,a=(0,o.Z)({},r),s=n.components[t].defaultProps;for(c in s)void 0===a[c]&&(a[c]=s[c]);return a}var l=t(31631),f=t(85893),d=["defaultTheme","withTheme","name"],h=["classes"],p=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(t){var a=n.defaultTheme,p=n.withTheme,g=void 0!==p&&p,v=n.name,m=(0,r.Z)(n,d);var w=v,E=(0,i.Z)(e,(0,o.Z)({defaultTheme:a,Component:t,name:v||t.displayName,classNamePrefix:w},m)),T=c.forwardRef((function(e,n){var c,s=(0,r.Z)(e,h),i=E((0,o.Z)({},t.defaultProps,e)),d=s;return("string"==typeof v||g)&&(c=(0,l.Z)()||a,v&&(d=u({theme:c,name:v,props:s})),g&&!d.theme&&(d.theme=c)),(0,f.jsx)(t,(0,o.Z)({ref:n,classes:i},d))}));return s()(T,t),T}}},18736:function(e,n,t){t.r(n);var o=t(15861),r=t(87757),c=t.n(r),a=t(67294),s=t(38037),i=t(7391),u=t(75557),l=t(54641),f=t(56645),d=t(18301),h=t(84324),p=t(1329),g=t(68923),v=t(16975),m=t(21370),w=t(17666),E=t(90281),T=t(16486),x=t(22591),D=t(25024),S=t(60428),A=t(4382);u.dQ.configure(D.Z);var C=(0,E.Z)({root:{backgroundColor:"#343434",width:"120px",color:"#CDCDCD",height:"40px",borderRadius:"30px",fontSize:"0.6rem","&:hover":{backgroundColor:v.Z[700]}},label:{textTransform:"none"}})(T.Z);n.default=function(){var e=(0,a.useContext)(i.Vo),n=e.authState,t=e.authActions,r=(0,a.useState)(!1),u=(r[0],r[1],(0,a.useState)(!0)),E=u[0],T=u[1],D=(0,a.useState)(!1),L=D[0],Z=D[1],N=(0,a.useState)(null),k=N[0],y=N[1],_=(0,a.useState)(!1),b=_[0],I=_[1],R=(0,a.useState)(!1),P=R[0],j=R[1],O=(0,x.Wd)("response_wkToken",x.Zp),U=O[0];O[1];(0,a.useEffect)((function(){U&&(console.log("@FOO"),console.log(U))}),[U]),(0,a.useEffect)((function(){var e=n.user.cognitoId;!P&&L&&e&&((0,m.mC)(e,t.setTransactions,t.setCards,t.set_HasNeverBought,t.appendTransactions,t.setCredits,t.setReplays,t.appendReplays),j(!0))}),[L,n]),(0,a.useEffect)((function(){var e=window.location.search,n=new URLSearchParams(e);console.log("@DEBUG"),console.log(n),console.log(URLSearchParams);var t=n.getAll("response_wkToken")[0];console.log(t);var o={name:"txSuccesPageVisit",attributes:{transactionId:t}};"undefined"!=typeof window&&null!=window.fbq&&window.fbq("track","purchaseSuccess"),w.c.record(o)}),[]);var H=function(e){console.log("@HANDLE TX"),console.log(e),h.b.graphql((0,p.wT)(f.fo,{id:e})).then((function(n){var t=n.data,o=t.getTransaction.scheduledTask,r=t.getTransaction.eventId;"undetermined"!=r&&(console.log("@HANDLE EVENT"),h.b.graphql((0,p.wT)(f.EY,{id:r})).then((function(n){var t=n.data.getEvent;if(y(t),"SENDMAIL"===o){var r=t.date;fetch("https://lxk20o6rz0.execute-api.eu-west-1.amazonaws.com/dev/"+e).then((function(n){var t=new Date/1e3,o="SENDMAIL1D",c=r-86400;r-t<86400&&(o="SENDMAIL1H",c=r-3600),r-t<3600&&(o="QUESTIONNAIRE",c=r+3600),h.b.graphql((0,p.wT)(d.Ld,{input:{id:e,scheduledTask:o,scheduledDate:c}})).then((function(e){return console.log("NEW SCHEDULED OK")})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}))}})).catch((function(e){return console.log(e)})));var c=t.getTransaction.cycleId;"undetermined"!=c&&h.b.graphql((0,p.wT)(f.I0,{id:c})).then((function(e){var n=e.data;y(n.getCycle)})).catch((function(e){return console.log(e)})),"undetermined"!=c&&"SENDMAIL"===o&&fetch("https://lxk20o6rz0.execute-api.eu-west-1.amazonaws.com/dev/"+e).then((function(n){h.b.graphql((0,p.wT)(d.Ld,{input:{id:e,scheduledTask:"CALCULATE",scheduledDate:0}})).then((function(e){return console.log("NEW SCHEDULED OK")})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}))},q=function(){var e=(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{l.g.currentSession().then((function(e){return console.log(e)})).catch((function(e){return console.log(e)})),console.log("@AWAITED"),Z(!0)}catch(n){"No current user"!==n&&(console.log("GROSS MOSTAKE"),console.log(n))}T(!1);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){console.log("@BRANCH-2");var e=window.location.search,n=new URLSearchParams(e).getAll("response_wkToken")[0];E||L||t.toggleLoginModal(3),b||E||!L||(H(n),I(!0))}),[E,L]),(0,a.useEffect)((function(){var e;console.log("@BRANCH-3");var t=window.location.search,o=new URLSearchParams(t).getAll("response_wkToken")[0];b||E||null===(e=n.user)||void 0===e||!e.id||(H(o),I(!0))}),[n]),(0,a.useEffect)((function(){q()}),[]),(0,a.useEffect)((function(){console.log("@EVENT DATA"),console.log(k),setTimeout((function(){(0,s.navigate)("/")}),2e4)}),[k]),(0,A.jsx)(g.Z,{width:"100%",height:"100%",marginTop:"40vh",display:"flex",flexDirection:"row",justifyContent:"center",justifyItems:"center",alignContent:"center",alignItems:"center"},k&&(k.title1||k.title)&&(0,A.jsx)(g.Z,{borderRadius:"20px",width:"100%",maxWidth:"450px",bgcolor:v.Z[200],padding:"30px"},(0,A.jsx)(S.Z,null,"Merci pour votre inscription ",k.title1&&"à l'événement",k.title&&"au cycle",": ",(0,A.jsx)("span",{style:{fontWeight:600}},k&&k.title1,k&&k.title," "),". Vous allez recevoir un mail de confirmation dans votre boite mail très prochainement."),(0,A.jsx)(g.Z,{padding:"50px 0px 10px 0px",display:"flex",flexDirection:"row",justifyItems:"center",justifyContent:"center"},(0,A.jsx)(C,{onClick:function(){return(0,s.navigate)("/")}},"Retour à Pekoia"))))}},15861:function(e,n,t){function o(e,n,t,o,r,c,a){try{var s=e[c](a),i=s.value}catch(u){return void t(u)}s.done?n(i):Promise.resolve(i).then(o,r)}function r(e){return function(){var n=this,t=arguments;return new Promise((function(r,c){var a=e.apply(n,t);function s(e){o(a,r,c,s,i,"next",e)}function i(e){o(a,r,c,s,i,"throw",e)}s(void 0)}))}}t.d(n,{Z:function(){return r}})}}]);
//# sourceMappingURL=component---src-pages-sandbox-success-js-837521eea10d6177488b.js.map