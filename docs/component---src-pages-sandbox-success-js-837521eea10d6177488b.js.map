{"version":3,"file":"component---src-pages-sandbox-success-js-837521eea10d6177488b.js","mappings":"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","sources":["webpack://gatsby-starter-default/./node_modules/@mui/styles/getThemeProps/getThemeProps.js","webpack://gatsby-starter-default/./node_modules/@mui/styles/withStyles/withStyles.js","webpack://gatsby-starter-default/./src/pages/sandboxSuccess.js","webpack://gatsby-starter-default/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"],"sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\n/* eslint-disable no-restricted-syntax */\n\nexport default function getThemeProps(params) {\n  var theme = params.theme,\n      name = params.name,\n      props = params.props;\n\n  if (!theme || !theme.components || !theme.components[name] || !theme.components[name].defaultProps) {\n    return props;\n  }\n\n  var output = _extends({}, props); // Resolve default props, code borrow from React source.\n  // https://github.com/facebook/react/blob/15a8f031838a553e41c0b66eb1bcf1da8448104d/packages/react/src/ReactElement.js#L221\n\n\n  var defaultProps = theme.components[name].defaultProps;\n  var propName;\n\n  for (propName in defaultProps) {\n    if (output[propName] === undefined) {\n      output[propName] = defaultProps[propName];\n    }\n  }\n\n  return output;\n}","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"defaultTheme\", \"withTheme\", \"name\"],\n    _excluded2 = [\"classes\"];\nimport * as React from 'react';\nimport PropTypes from 'prop-types';\nimport hoistNonReactStatics from 'hoist-non-react-statics';\nimport { getDisplayName } from '@mui/utils';\nimport makeStyles from '../makeStyles';\nimport getThemeProps from '../getThemeProps';\nimport useTheme from '../useTheme'; // Link a style sheet with a component.\n// It does not modify the component passed to it;\n// instead, it returns a new component, with a `classes` property.\n\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nvar withStyles = function withStyles(stylesOrCreator) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return function (Component) {\n    var defaultTheme = options.defaultTheme,\n        _options$withTheme = options.withTheme,\n        withTheme = _options$withTheme === void 0 ? false : _options$withTheme,\n        name = options.name,\n        stylesOptions = _objectWithoutPropertiesLoose(options, _excluded);\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (Component === undefined) {\n        throw new Error(['You are calling withStyles(styles)(Component) with an undefined component.', 'You may have forgotten to import it.'].join('\\n'));\n      }\n    }\n\n    var classNamePrefix = name;\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (!name) {\n        // Provide a better DX outside production.\n        var displayName = getDisplayName(Component);\n\n        if (displayName !== undefined) {\n          classNamePrefix = displayName;\n        }\n      }\n    }\n\n    var useStyles = makeStyles(stylesOrCreator, _extends({\n      defaultTheme: defaultTheme,\n      Component: Component,\n      name: name || Component.displayName,\n      classNamePrefix: classNamePrefix\n    }, stylesOptions));\n    var WithStyles = /*#__PURE__*/React.forwardRef(function WithStyles(props, ref) {\n      var other = _objectWithoutPropertiesLoose(props, _excluded2); // The wrapper receives only user supplied props, which could be a subset of\n      // the actual props Component might receive due to merging with defaultProps.\n      // So copying it here would give us the same result in the wrapper as well.\n\n\n      var classes = useStyles(_extends({}, Component.defaultProps, props));\n      var theme;\n      var more = other;\n\n      if (typeof name === 'string' || withTheme) {\n        // name and withTheme are invariant in the outer scope\n        // eslint-disable-next-line react-hooks/rules-of-hooks\n        theme = useTheme() || defaultTheme;\n\n        if (name) {\n          more = getThemeProps({\n            theme: theme,\n            name: name,\n            props: other\n          });\n        } // Provide the theme to the wrapped component.\n        // So we don't have to use the `withTheme()` Higher-order Component.\n\n\n        if (withTheme && !more.theme) {\n          more.theme = theme;\n        }\n      }\n\n      return /*#__PURE__*/_jsx(Component, _extends({\n        ref: ref,\n        classes: classes\n      }, more));\n    });\n    process.env.NODE_ENV !== \"production\" ? WithStyles.propTypes = {\n      /**\n       * Override or extend the styles applied to the component.\n       */\n      classes: PropTypes.object\n    } : void 0;\n\n    if (process.env.NODE_ENV !== 'production') {\n      WithStyles.displayName = \"WithStyles(\".concat(getDisplayName(Component), \")\");\n    }\n\n    hoistNonReactStatics(WithStyles, Component);\n\n    if (process.env.NODE_ENV !== 'production') {\n      // Exposed for test purposes.\n      WithStyles.Naked = Component;\n      WithStyles.options = options;\n      WithStyles.useStyles = useStyles;\n    }\n\n    return WithStyles;\n  };\n};\n\nexport default withStyles;","import React, { useEffect, useContext, useState } from \"react\"\nimport { navigate } from \"gatsby-link\"\nimport { AuthContext } from \"../context/general\"\nimport  { Amplify, Auth } from 'aws-amplify'\nimport { getTransaction, getEvent, getCycle } from '../graphql/queries'\nimport { updateTransaction } from '../graphql/mutations'\nimport { API, graphqlOperation } from \"aws-amplify\"\nimport Box from '@mui/material/Box'\nimport { grey } from '@mui/material/colors'\nimport { fetchTransactions } from '../helpers/fetchers'\nimport { Analytics } from 'aws-amplify'\nimport withStyles from '@mui/styles/withStyles';\nimport Button from '@mui/material/Button'\nimport { useQueryParam, NumberParam, StringParam } from \"use-query-params\"\n\n\nimport awsConfig from '../aws-exports'\nimport { Typography } from \"@mui/material\"\nAmplify.configure(awsConfig)\n\nconst Ics = () => {\n\n  const { authState, authActions } = useContext(AuthContext)\n  const [ready, setReady] = useState(false)\n  const [isAuthenticating, setIsAuthenticating] = useState(true)\n  const [isAuthenticated, userHasAuthenticated] = useState(false)\n  const [eventData, setEventData] = useState(null)\n  const [handled, setHandled] = useState(false)\n  const [fetched, setFetched] = useState(false)\n\n  const [foo, setFoo] = useQueryParam(\"response_wkToken\", StringParam)\n\n  useEffect(()=>{\n\n    if (foo){\n\n      console.log('@FOO')\n      console.log(foo)\n\n    }\n  \n\n  },[foo])\n\n\n\n  useEffect(() => {\n\n    \n \n\n\n    const cognitoId = authState.user.cognitoId\n\n\n   \n    if ( !fetched && isAuthenticated && cognitoId) {\n\n    \n      \n      fetchTransactions(cognitoId, authActions.setTransactions, authActions.setCards, authActions.set_HasNeverBought, authActions.appendTransactions, authActions.setCredits, authActions.setReplays, authActions.appendReplays)\n      setFetched(true)\n    \n    }\n\n\n\n  }, [isAuthenticated, authState])\n\n  useEffect(() => {\n\n    const paramsString = window.location.search\n    var searchParams = new URLSearchParams(paramsString)\n\n    console.log('@DEBUG')\n    console.log(searchParams)\n    console.log(URLSearchParams)\n\n    const txId = searchParams.getAll(\"response_wkToken\")[0]\n    console.log(txId)\n    const attributes = {\n      transactionId : txId\n    }\n\n    const record = {\n      name: 'txSuccesPageVisit',\n      attributes: attributes }\n   \n\n    if (process.env.NODE_ENV === \"production\") {\n\n      if (typeof window !== \"undefined\") {\n        if (window.fbq != null) {\n          window.fbq('track', 'purchaseSuccess');\n        }\n      }\n\n      Analytics.record(record)\n\n    }\n\n\n\n  }, [])\n\n\n  const handleTX = (txId) => {\n\n    console.log('@HANDLE TX')\n    console.log(txId)\n\n\n\n\n\n    API.graphql(graphqlOperation(getTransaction, { id: txId }))\n      .then(({ data }) => {\n\n\n\n        const scheduledTask = data.getTransaction.scheduledTask\n        // CASE 1: HANDLE SINGLE\n        // BASE CASE. CLIENT HAS GONE TRHOUGHT THE PROCESS AT REASONABLE PACE AND scheduledTask === SENDMAIL\n        // OTHER WISE INITIAL MAIL HAS BEEN SENT BY ANOTHER PROCESS AND NOTHING TO DO\n        const eventId = data.getTransaction.eventId\n        if ((eventId != 'undetermined'))      // not === undetermined\n        {\n\n          console.log('@HANDLE EVENT')\n          // SEND CONFIRMATION MAIL\n          API.graphql(graphqlOperation(getEvent, { id: eventId }))\n            .then(({data}) => {\n\n              const getEventData = data.getEvent\n              setEventData(getEventData)\n\n\n\n\n            \n\n              if ((scheduledTask === 'SENDMAIL')) {\n\n                //https://lxk20o6rz0.execute-api.eu-west-1.amazonaws.com/dev\n\n                const eventDate = getEventData.date\n                fetch(`https://lxk20o6rz0.execute-api.eu-west-1.amazonaws.com/dev/${txId}`)\n                  .then(_ => {\n\n                    // PREPARE NEXT EVENT IN THE SCHEDULER\n                    const now = new Date() / 1000\n                    let scheduledTask = 'SENDMAIL1D'\n                    let scheduledDate = eventDate - 3600 * 24\n\n                    if ((eventDate - now) < 3600 * 24) {\n\n                      scheduledTask = 'SENDMAIL1H'\n                      scheduledDate = eventDate - 3600\n\n                    }\n\n                    if ((eventDate - now) < 3600) {\n\n                      scheduledTask = 'QUESTIONNAIRE'\n                      scheduledDate = eventDate + 3600\n\n                    }\n\n                   \n\n                    API.graphql(graphqlOperation(updateTransaction, { input: {id: txId, scheduledTask: scheduledTask, scheduledDate: scheduledDate} }))\n                      .then(data => console.log('NEW SCHEDULED OK'))\n                      .catch(err => console.log(err))\n\n\n                  })\n                  .catch(err => console.log(err))\n\n              }\n\n              //PREVIOUS\n              //setEventData(getEventData)\n            })\n            .catch(err => console.log(err))\n\n        }\n\n\n        // CASE 2: HANDLE CYCLE\n        const cycleId = data.getTransaction.cycleId\n\n        if ((cycleId != 'undetermined')){\n          API.graphql(graphqlOperation(getCycle, { id: cycleId }))\n          .then(({data})=>{\n            setEventData(data.getCycle)\n           \n          })\n          .catch(err=>console.log(err))\n          \n        }\n       \n        if ((cycleId != 'undetermined') && (scheduledTask === 'SENDMAIL')) {\n\n\n          fetch(`https://lxk20o6rz0.execute-api.eu-west-1.amazonaws.com/dev/${txId}`)\n            .then(_ => {\n\n              const scheduledTask = 'CALCULATE'\n              const scheduledDate = 0\n              // PREPARE NEXT EVENT IN THE SCHEDULER\n              API.graphql(graphqlOperation(updateTransaction, {input : { id: txId, scheduledTask: scheduledTask, scheduledDate: scheduledDate }}))\n                .then(data => console.log('NEW SCHEDULED OK'))\n                .catch(err => console.log(err))\n\n            })\n            .catch(err => console.log(err))\n\n\n        }\n      })\n      .catch(err => console.log(err))\n\n\n  }\n\n\n  const onLoad = async () => {\n    try {\n      Auth.currentSession()\n        .then(data => console.log(data))\n        .catch(err => console.log(err))\n      console.log('@AWAITED')\n      userHasAuthenticated(true);\n    }\n    catch (e) {\n      if (e !== 'No current user') {\n        console.log('GROSS MOSTAKE')\n        console.log(e)\n      }\n    }\n\n    setIsAuthenticating(false);\n  }\n\n  useEffect(() => {\n\n    console.log('@BRANCH-2')\n\n  \n\n    const paramsString = window.location.search\n    var searchParams = new URLSearchParams(paramsString)\n    const txId = searchParams.getAll(\"response_wkToken\")[0]\n\n    if (!isAuthenticating && !isAuthenticated) {\n      authActions.toggleLoginModal(3)\n    }\n\n    if (!handled && !isAuthenticating && isAuthenticated) {\n\n      handleTX(txId)\n      setHandled(true)\n    }\n\n\n\n  }, [isAuthenticating, isAuthenticated])\n\n  useEffect(() => {\n    console.log('@BRANCH-3')\n    const paramsString = window.location.search\n    var searchParams = new URLSearchParams(paramsString)\n    const txId = searchParams.getAll(\"response_wkToken\")[0]\n\n\n    if (!handled && !isAuthenticating && authState.user?.id){\n      handleTX(txId)\n      setHandled(true)\n    }\n     \n\n\n\n  }, [authState])\n\n\n  useEffect(() => {\n\n    onLoad()\n\n  }, [])\n\n\n  useEffect(() => {\n\n    console.log('@EVENT DATA')\n    console.log(eventData)\n\n\n    setTimeout(() => {\n      navigate('/')\n    }, 20000);\n\n  }, [eventData])\n\n  return (<Box width=\"100%\" height=\"100%\" marginTop=\"40vh\" display=\"flex\" flexDirection=\"row\" justifyContent=\"center\" justifyItems=\"center\" alignContent=\"center\" alignItems=\"center\">\n    {eventData && (eventData.title1 || eventData.title) && < Box borderRadius=\"20px\" width=\"100%\" maxWidth=\"450px\" bgcolor={grey[200]} padding=\"30px\">\n      <Typography>\n        Merci pour votre inscription {eventData.title1 && \"à l'événement\"}{eventData.title && \"au cycle\"}: <span style={{ fontWeight: 600 }}>{eventData && eventData.title1}{eventData && eventData.title} </span>. Vous allez recevoir un mail de confirmation dans votre boite mail très prochainement.\n      </Typography>\n      <Box padding=\"50px 0px 10px 0px\" display=\"flex\" flexDirection=\"row\" justifyItems=\"center\" justifyContent=\"center\">\n      <RetourButton onClick={()=>navigate('/')}>\n        Retour à Pekoia\n      </RetourButton>\n\n      </Box>\n      \n\n    </Box>}\n\n  </Box>)\n}\n\nconst RetourButton = withStyles({\n  root: {\n    backgroundColor: \"#343434\",\n    width: '120px',\n    color: '#CDCDCD',\n    height: '40px',\n    borderRadius: '30px',\n    fontSize: '0.6rem',\n\n    '&:hover': {\n      backgroundColor: grey[700]\n    }\n  },\n  label: {\n    textTransform: 'none',\n  },\n})(Button)\n\n\n\n\n\nexport default Ics","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}"],"names":["getThemeProps","params","theme","name","props","components","defaultProps","propName","output","undefined","_excluded","_excluded2","stylesOrCreator","options","arguments","length","Component","defaultTheme","_options$withTheme","withTheme","stylesOptions","classNamePrefix","useStyles","makeStyles","displayName","WithStyles","ref","other","classes","more","useTheme","Amplify","awsConfig","RetourButton","withStyles","root","backgroundColor","width","color","height","borderRadius","fontSize","grey","label","textTransform","Button","useContext","AuthContext","authState","authActions","useState","isAuthenticating","setIsAuthenticating","isAuthenticated","userHasAuthenticated","eventData","setEventData","handled","setHandled","fetched","setFetched","useQueryParam","StringParam","foo","useEffect","console","log","cognitoId","user","fetchTransactions","setTransactions","setCards","set_HasNeverBought","appendTransactions","setCredits","setReplays","appendReplays","paramsString","window","location","search","searchParams","URLSearchParams","txId","getAll","record","attributes","transactionId","fbq","Analytics","handleTX","API","graphqlOperation","getTransaction","id","then","data","scheduledTask","eventId","getEvent","getEventData","eventDate","date","fetch","_","now","Date","scheduledDate","updateTransaction","input","catch","err","cycleId","getCycle","onLoad","Auth","e","toggleLoginModal","_authState$user","setTimeout","navigate","___EmotionJSX","Box","marginTop","display","flexDirection","justifyContent","justifyItems","alignContent","alignItems","title1","title","maxWidth","bgcolor","padding","Typography","style","fontWeight","onClick","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","_asyncToGenerator","fn","self","this","args","apply"],"sourceRoot":""}